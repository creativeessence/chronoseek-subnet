# Pattern: Compute Auction Marketplace
# Example: Targon (SN4)

metadata:
  name: compute_auction
  category: compute
  examples: ["Targon SN4"]

when_to_use:
  commodity: "fungible compute resources (GPUs, CPUs, VMs)"
  value_source: "verified hardware capability + competitive pricing"
  verification: "hardware attestation"

architecture:
  miner:
    registration: "hotkey on subnet"
    infrastructure: "CVM/GPU cluster with real hardware"
    endpoint: "HTTP /cvm advertising resources"
    authentication: "Epistula signed headers"
    commitment: "endpoint URL to chain"
    publishes:
      - gpu_type
      - vram_gb
      - bid_per_hour
      - attestation_proof
  
  validator:
    queries: "all miner endpoints for bids"
    verifies: "hardware attestation (Tower or similar)"
    deduplicates: "same hardware, different hotkeys"
    algorithm: "auction clearing"
    output: "u16 weights on-chain"

auction_clearing:
  process:
    1: "group by resource type (buckets)"
    2: "sort by price ascending"
    3: "allocate emission budget"
    4: "pay cheapest providers first"
  pricing: "clearing price or bid"

anti_gaming:
  hardware_attestation: "prevents GPU spoofing"
  deduplication: "prevents multi-hotkey same-hardware"
  auction_mechanism: "rewards honest pricing"

epistula_protocol:
  headers:
    timestamp: "X-Epistula-Timestamp (nonce)"
    signature: "X-Epistula-Signature"
    hotkey: "X-Epistula-Hotkey"
  message: "{nonce}.{sha256(body)}"
  signature: "wallet.hotkey.sign(message)"

miner_response_schema:
  gpu_type: string
  vram_gb: int
  bid_per_hour: float
  attestation: string

scoring:
  base: "1.0 - bid / max_bid"
  multipliers:
    gpu_type:
      H100: 1.2
      A100: 1.0
      V100: 0.7
      other: 0.5
  final: "base * multiplier"

selection_criteria:
  use_when:
    - commodity_is_fungible_compute
    - value_in_price_competition
    - hardware_verification_needed
  
  dont_use_when:
    - quality_differentiation_matters
    - ground_truth_delayed
    - external_activity_based
