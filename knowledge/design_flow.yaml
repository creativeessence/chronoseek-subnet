# Stepwise Reasoning Flow for Subnet Design

entry_point:
  question: "What am I actually measuring?"
  constraint: "Must answer in ONE sentence"
  if_contains_and: "Simplify. Pick one thing."
  if_vague: "Be more specific"
  proceed_when: "Clear, single measurement identified"

decision_tree:
  step_1_commodity_type:
    question: "What type of commodity do miners provide?"
    options:
      compute:
        fungible: "→ compute_auction pattern"
        always_on: "→ capacity_market pattern"
      data:
        unique_datasets: "→ data_indexing pattern"
      predictions:
        future_events: "→ prediction_market pattern"
        time_series: "→ time_series_forecasting pattern"
      external:
        third_party_activity: "→ external_activity_verification pattern"
      detection_generation:
        arms_race_beneficial: "→ adversarial_red_blue pattern"
      software:
        agents_or_solvers: "→ container_execution pattern"

  step_2_ground_truth:
    question: "Where does ground truth come from?"
    options:
      immediate:
        validator_can_verify_now: "direct verification"
      delayed:
        truth_arrives_later: "delayed scoring pattern"
      external:
        third_party_api: "external verification"
      emergent:
        miners_create_challenges: "adversarial pattern"
      DANGER:
        validator_controls_truth: "WARNING: redesign needed"

  step_3_trust_check:
    questions:
      - "Does validator control ground truth? → DANGER"
      - "Are there secret eval sets? → FORBIDDEN"
      - "Relying on similarity detection? → UNRELIABLE"
      - "Relying on coldkey dedup for sybil? → INEFFECTIVE"
    if_any_yes: "Redesign mechanism"

  step_4_compute_check:
    question: "Who runs expensive compute?"
    correct: "Miners host endpoints, validators make API calls"
    incorrect: "Validators download models, run inference"
    if_incorrect: "Redesign: push compute to miners"

  step_5_pattern_selection:
    based_on: "commodity type + verification method"
    select_one:
      compute_auction:
        when: "fungible compute, price competition"
      capacity_market:
        when: "always-on infra, usage-based"
      data_indexing:
        when: "unique datasets, sample verification"
      prediction_market:
        when: "future predictions, delayed ground truth"
      time_series_forecasting:
        when: "sequential predictions, baseline comparison"
      external_activity_verification:
        when: "third-party platform activity"
      adversarial_red_blue:
        when: "detection+generation, no validator truth control"
      container_execution:
        when: "miners compete on code quality"

  step_6_implementation:
    file: "validator.py"
    contains:
      - configuration
      - miner_interface_spec
      - scoring_logic
      - weight_setting
      - main_loop
    excludes:
      - miner_code
      - reference_implementations

validation_checklist:
  architecture:
    - single_file_validator_py: required
    - no_miner_code: required
    - open_source_preference: required
  
  trust:
    - no_secret_eval_sets: required
    - ground_truth_not_validator_controlled: required
    - no_similarity_detection_reliance: required
  
  compute:
    - costs_on_miners: required
    - validators_make_api_calls: required
  
  sybil:
    - no_coldkey_dedup_for_sybil: required
    - understand_uid_pressure: required

output_format:
  required_sections:
    docstring:
      - what_measuring
      - miner_endpoints
      - request_format
      - response_format
      - scoring_criteria
    
    code:
      - configuration_constants
      - miner_interface_definitions
      - scoring_functions
      - weight_normalization
      - main_validation_loop
