# Subnet Invariants
# Non-negotiable constraints that define valid subnet behavior

architecture:
  validator_only_development:
    rule: "ONLY write validator.py. NEVER write miner code."
    rationale: "Validators define the game; miners infer how to play"
    enforcement: "single-file pattern"
    violation_indicator: "miner/ directory or reference implementations"

  primary_design_axis:
    question: "What am I actually measuring?"
    constraint: "Must answer in ONE sentence"
    invalid_answers:
      - "I'm measuring AI" # too vague
      - "various things depending on task" # unfocused
      - "compute and storage and inference" # too many things
    rule: "If answer contains 'and', simplify"

  open_source_preference:
    rule: "Open source > black box mechanisms"
    rationale:
      - new_miners_learn_from_leaders
      - subnet_improves_over_time
      - constrained_attack_surface
      - transparency_breeds_trust
    miner_commits:
      - github_repos
      - docker_images
      - huggingface_models
      - chutes_endpoints
      - ipfs_hashes

communication:
  axon_dendrite_synapse:
    status: DEPRECATED
    rule: "NEVER use for new development"
    replacement: "HTTP APIs with Epistula signing"
    rationale:
      - proprietary_limits_flexibility
      - poor_production_performance
      - encourages_closed_source
      - obscures_actual_behavior

  discovery:
    method: "miners commit connection info to chain"
    validator_reads: "chain commitments for endpoints"
    supports:
      - api_endpoints
      - s3_urls
      - hippius_bucket_urls
      - database_endpoints
      - docker_images
      - any_protocol

chain_commitment_rate_limit:
  rule: "Commitments limited to 1 per 100 blocks (~20 minutes)"
  implication: "Commit STORAGE LOCATION, not individual data items"
  
  correct_pattern:
    description: "Commit bucket URL once, validators pull from bucket"
    example: "subtensor.set_commitment(wallet, netuid, 'hippius://my-bucket')"
  
  incorrect_pattern:
    description: "Commit each CID or data hash to chain"
    why_wrong: "Rate limit makes this impractical for high-frequency data"
  
  data_freshness_verification:
    method: "Hippius timestamps prove when data was stored"
    not_needed: "Per-item chain commits for provenance"

compute_distribution:
  rule: "Push compute costs to miners, NOT validators"
  rationale:
    - validators_should_be_cheap
    - miner_infrastructure_already_incentivized
    - expensive_validators_cause_centralization
  
  pattern:
    bad: "validators download models, run inference locally"
    good: "miners host endpoints, validators make API calls"
  
  chutes_integration: "miners deploy to Chutes, validators query API"

commit_reveal:
  weights:
    rule: "Commit-reveal weights is a MATURE subnet tool, NOT a default"
    when_to_use: "ONLY if weight copying is proven problem"
    warning: "adds complexity, can cause issues if not handled"
  
  data:
    rule: "Commit-reveal data (drand timelock) useful for provenance"
    purpose: "prove data existed at time without revealing"
    NOT_for: "secrecy (validators will leak)"

hyperparameters:
  not_changeable:
    - tempo: "locked despite appearing in docs"
    - max_allowed_uids: "locked"
  
  changeable:
    - immunity_period
    - weights_rate_limit
    - max_weights_limit
    - min_allowed_weights
    - commit_reveal_weights_enabled
    - commit_reveal_period
    - difficulty
    - min_burn
    - max_burn

container_requirement:
  rule: "When miners compete on SOFTWARE not HARDWARE, use containers"
  trigger_questions:
    - "Are miners building algorithms/solvers/agents?"
    - "Is competitive advantage from code written?"
  
  if_yes:
    use: "Basilica containers"
    miners: "build Docker, push to Hub, commit URL"
    validators: "pull image, run in sandbox, score"
  
  if_no:
    use: "query-based pattern may be appropriate"
    examples: "GPU inference, storage, bandwidth"

adversarial_pattern:
  trigger: "detection/generation tasks where ground truth is expensive"
  rule: "Red/Blue team removes validator ground-truth control"
  mechanism:
    red_team: "generate fakes/challenges"
    blue_team: "detect/solve"
    validators: "orchestrate, don't control answers"
  benefit: "answer emerges from miner competition"
