# Pattern: Time-Series Forecasting
# Example: Zeus (SN18)

metadata:
  name: time_series_forecasting
  category: forecasting
  examples: ["Zeus SN18"]

when_to_use:
  commodity: "predictions with delayed ground truth"
  value_source: "accuracy vs baseline + speed"
  verification: "external data source after delay"

architecture:
  miner:
    receives: "forecast request (location, variables, horizon)"
    returns: "predictions in required format"
    speed_matters: "faster = higher efficiency score"
  
  validator:
    phases:
      1_online:
        action: "query miners for predictions"
        immediate: "penalize malformed/timeout"
        store: "valid predictions"
      
      2_delayed_scoring:
        trigger: "when ground truth available"
        fetch: "actual data (e.g., ERA5 weather)"
        calculate: "quality and efficiency scores"
    
    scoring:
      quality:
        formula: "(baseline_rmse - miner_rmse) / baseline_rmse"
        interpretation: "improvement over baseline"
      
      efficiency:
        formula: "1.0 - (response_time / max_time)"
        interpretation: "speed bonus"
      
      combined:
        formula: "quality_weight * quality + efficiency_weight * efficiency"
    
    ema_accumulation:
      alpha_new_miners: "higher (adapt quickly)"
      alpha_established: "lower (stable)"

baseline_comparison:
  method: "score relative to known baseline"
  example: "OpenMeteo for weather"
  formula: "(baseline_error - miner_error) / baseline_error"
  benefit: "normalizes difficulty across conditions"

anti_gaming:
  immediate_timeout_penalty: "malformed/late = 0"
  delayed_ground_truth: "can't game before event"
  baseline_relative: "must beat known source"
  ema_smoothing: "prevents single-shot gaming"

selection_criteria:
  use_when:
    - sequential_predictions
    - baseline_comparison_meaningful
    - response_time_matters
    - ground_truth_from_external_source
  
  dont_use_when:
    - no_baseline_available
    - immediate_verification_possible
    - speed_irrelevant
