# Validator Rules
# Constraints and guidance for validator implementation

trust_model:
  validators_not_trusted:
    rule: "Validators are NOT individually trustworthy"
    implication: "Secret eval sets WILL leak"
    reason: "validator running own miners will share info"
    this_attack_is: "invisible and certain on valuable subnets"

ground_truth:
  validator_controlled:
    status: DANGEROUS
    rule: "If validators control ground truth, they can leak to own miners"
    especially_dangerous_when:
      - simple_answers: "binary classification, short text"
      - secret_eval_sets: "validators know answers before query"
      - validators_know_correct_answer: "before querying miners"

  solutions_by_pattern:
    external_ground_truth:
      method: "score against third-party data arriving after deadline"
      best_for: "predictions, prices"
    
    fresh_web_content:
      method: "source from verifiable URLs with timestamps"
      best_for: "data verification"
      scale: "massive prevents memorization"
    
    adversarial_red_blue:
      method: "miners generate challenges for each other"
      best_for: "detection/generation"
      key: "validators don't know the answer"
    
    cryptographic_attestation:
      method: "hardware proofs validators can't fake"
      best_for: "compute verification"
    
    public_eval_criteria:
      method: "fully transparent scoring"
      rationale: "knowing how scored doesn't help cheat"
      best_for: "quality-based tasks"
    
    timestamped_provenance:
      method: "store data with blockchain-anchored timestamps"
      tool: "hippius.integration.yaml"
      best_for: "proving temporal ordering"
      use_case: "commit-reveal, submission deadlines"

secret_eval_sets:
  status: FORBIDDEN
  rule: "Secret eval sets ALWAYS fail"
  attack:
    1: "validator knows answer"
    2: "validator tells own miner"
    3: "miner gets perfect scores"
    4: "honest miners lose"
  
  DO_NOT:
    - maintain_secret_holdout_set
    - trust_validators_keep_criteria_private
    - assume_rotating_secrets_sufficient
  
  alternatives:
    - deterministic_synthetic_generation
    - external_ground_truth_after_deadline
    - tasks_where_knowing_criteria_doesnt_help
    - public_transparent_criteria

scoring:
  DO:
    - define_clear_criteria
    - be_deterministic
    - use_ema_for_stability
    - handle_timeouts_gracefully
    - normalize_weights_correctly
  
  DO_NOT:
    - hide_scoring_logic
    - use_random_selection_without_seed
    - ignore_rate_limits

weight_setting:
  rate_limit: "respect weights_rate_limit hyperparameter"
  normalization: "weights must sum to 1"
  commit_reveal:
    when: "ONLY if weight copying proven"
    period: "50-100 blocks insufficient"

anti_gaming:
  coldkey_dedup:
    method: "keep highest scorer per coldkey"
    limitation: "NOT sybil-proof"
  
  similarity_detection:
    status: UNRELIABLE
    rule: "easier to evade than enforce"
    alternative: "design around copying"

implementation:
  single_file:
    rule: "All logic in validator.py"
    contains:
      - configuration
      - miner_interface_spec
      - scoring_logic
      - weight_setting
      - main_loop
  
  docstring:
    required: true
    contains:
      - what_measuring
      - miner_endpoints
      - request_format
      - response_format
      - scoring_criteria
